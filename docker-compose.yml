services:
  nutracheck:
    image: ghcr.io/liamgwallace/nutracheck:latest
    pull_policy: always
    container_name: nutracheck-health-tracker
    restart: unless-stopped

    environment:
      # Mode: webapp (default) or cron
      MODE: ${MODE:-webapp}

      # Nutracheck Credentials (REQUIRED)
      NUTRACHECK_EMAIL: ${NUTRACHECK_EMAIL}
      NUTRACHECK_PASSWORD: ${NUTRACHECK_PASSWORD}

      # GitHub Configuration (only needed for cron mode)
      GITHUB_TOKEN: ${GITHUB_TOKEN:-}
      GITHUB_REPO: ${GITHUB_REPO:-liamgwallace/HealthData}

      # File paths - save to /app/output for persistence
      KCAL_PLOT_FILE: ${KCAL_PLOT_FILE:-/app/output/liam_kcal_plot.png}
      MASS_FAT_PLOT_FILE: ${MASS_FAT_PLOT_FILE:-/app/output/liam_mass_fat_plot.png}
      DATA_FILE: ${DATA_FILE:-/app/output/daily_data.json}
      COOKIES_FILE: ${COOKIES_FILE:-/app/output/cookies.pkl}

      # Run on startup (webapp: false, cron: true)
      RUN_ON_STARTUP: ${RUN_ON_STARTUP:-false}

      # Timezone (default UTC)
      TZ: ${TZ:-UTC}

    ports:
      # Expose Flask web app on port 5000
      - "${HOST_PORT:-5000}:5000"

    volumes:
      # Only persist data files, NOT the entire /app directory
      - nutracheck-data:/app/output

    # Optional: Override the default cron schedule
    # command: ["cron", "-f"]  # Run cron in foreground

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  nutracheck-data:
    name: nutracheck-data
